@startuml Actividad_Simulador_Actualizado
title "Diagrama de Actividad - Flujo Principal del Simulador"

|Usuario|
start
:Cargar archivo de procesos;
:Configurar parámetros simulación;
:Seleccionar algoritmo planificación;
:Iniciar simulación;

|Aplicación|
:Validar datos entrada;
:Crear workload de procesos;
:Configurar motor simulación;
:Inicializar estado sistema;

|Motor de Simulación|
:Programar eventos iniciales de arribo;
note right
**Eventos Iniciales:**
• JOB_LLEGA para cada proceso
• Ordenados por tiempo arribo
• Cola de eventos cronológica
end note

while (¿Quedan eventos pendientes?) is (SÍ)
  :Obtener próximo evento (menor tiempo);
  :Avanzar tiempo sistema al evento;
  
  switch (Tipo de evento)
  case (JOB_LLEGA)
    :Crear proceso en sistema;
    :Aplicar TIP;
    :Programar FIN_TIP;
    
  case (FIN_TIP)
    :Transición NUEVO → LISTO;
    :Insertar en Ready Queue;
    if (¿CPU libre?) then (SÍ)
      :Evaluar dispatch inmediato;
    endif
    
  case (DISPATCH)
    :Seleccionar próximo proceso;
    :Aplicar TCP;
    :LISTO → CORRIENDO;
    :Programar FIN_RAFAGA_CPU;
    
  case (FIN_RAFAGA_CPU)
    if (¿Más ráfagas restantes?) then (SÍ)
      :CORRIENDO → BLOQUEADO;
      :Programar FIN_IO;
    else (NO)
      :CORRIENDO → TERMINADO;
      :Aplicar TFP;
      :Liberar recursos;
    endif
    
  case (FIN_IO)
    :BLOQUEADO → LISTO;
    :Insertar en Ready Queue;
    if (¿Debe expropiar CPU?) then (SÍ)
      :Programar expropiación;
    endif
    
  case (QUANTUM_EXPIRES)
    :CORRIENDO → LISTO (con TCP pendiente);
    :Re-encolar al final Ready Queue;
    :Evaluar próximo dispatch;
    
  endswitch
  
  :Actualizar estadísticas sistema;
  :Registrar evento en historial;
  
endwhile (NO)

:Calcular métricas finales;
:Generar diagrama Gantt;
:Crear reporte estadísticas;

|Aplicación|
:Mostrar resultados simulación;
:Generar gráficos utilización;
:Permitir exportación datos;

|Usuario|
:Visualizar resultados;
:Exportar reportes;

note top of start
**FLUJO PRINCIPAL - SIMULADOR DE PLANIFICACIÓN**

**Actores Involucrados:**
• **Usuario:** Configura parámetros y ejecuta simulación
• **Aplicación:** Interfaz y lógica de aplicación
• **Motor:** Núcleo de simulación y motor de eventos

**Responsabilidades por Capa:**
• **UI:** Carga archivos, configuración, visualización
• **Application:** Validación, transformación, coordinación
• **Core:** Simulación de eventos, algoritmos, cálculos

**Artefactos Generados:**
• Diagrama Gantt temporal
• Métricas de rendimiento
• Historial de eventos
• Reportes exportables
end note

note bottom of stop
**CARACTERÍSTICAS DEL MOTOR DE SIMULACIÓN**

**Gestión de Eventos:**
• Cola de eventos cronológica prioritizada
• Eventos discretos temporalmente ordenados
• Procesamiento secuencial garantizado

**Algoritmos Soportados:**
• **FCFS:** First Come First Served
• **Round Robin:** Con quantum configurable
• **SJF:** Shortest Job First (servicio total)
• **SRTF:** Shortest Remaining Time First
• **Priority:** Con/sin expropiación y aging opcional

**Métricas Calculadas:**
• Tiempo de retorno (turnaround time)
• Tiempo de espera (waiting time)
• Tiempo de respuesta (response time)
• Utilización de CPU
• Throughput del sistema

**Eventos del Sistema:**
• JOB_LLEGA, FIN_TIP, DISPATCH
• FIN_RAFAGA_CPU, FIN_IO
• QUANTUM_EXPIRES (Round Robin)
• Expropiaciones por algoritmo
end note
  stop
  
  note right
  **Características:**
  • Expropiación agresiva por tiempo restante
  • Óptimo para tiempo promedio respuesta
  • Mayor overhead TCP por expropiaciones frecuentes
  • Continua reevaluación tiempos restantes
  • Versión expropiativa de SJF
  end note
}

note top of "Sistema Principal - Bucle Central"
**REGLAS CRÍTICAS DE TEMPORIZACIÓN**

1. **TCP (Tiempo Cambio Contexto):**
   • Se aplica ÚNICAMENTE en LISTO → CORRIENDO
   • Se aplica en expropiaciones (CORRIENDO → LISTO → CORRIENDO)
   • NUNCA en transiciones instantáneas

2. **Transiciones INSTANTÁNEAS (Δt=0):**
   • NUEVO → LISTO (fin TIP)
   • CORRIENDO → BLOQUEADO (fin ráfaga CPU)  
   • BLOQUEADO → LISTO (fin I/O)

3. **Tiempos Administrativos:**
   • TIP: al ingreso del proceso (NUEVO)
   • TFP: al término del proceso (TERMINADO)
   • TCP: solo en despacho y expropiación

4. **Orden Eventos Simultáneos (por prioridad):**
   1. Corriendo → Terminado
   2. Corriendo → Bloqueado
   3. Corriendo → Listo (expropiación)
   4. Bloqueado → Listo (fin I/O)
   5. Nuevo → Listo (fin TIP)
   6. Listo → Corriendo (despacho)
end note

@enduml